var c=require("@UnsuppressEmbeds/manifest.json");function B(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var F=B(c);function A(e){return window.enmity.assets.getIDByName(e)}const{components:t}=window.enmity;t.Alert,t.Button,t.FlatList,t.Image,t.ImageBackground,t.KeyboardAvoidingView,t.Modal,t.Pressable,t.RefreshControl;const M=t.ScrollView;t.SectionList,t.StatusBar,t.StyleSheet,t.Switch;const g=t.Text;t.TextInput,t.TouchableHighlight,t.TouchableOpacity,t.TouchableWithoutFeedback,t.Touchable;const C=t.View;t.VirtualizedList,t.Form,t.FormArrow,t.FormCTA,t.FormCTAButton,t.FormCardSection,t.FormCheckbox,t.FormDivider,t.FormHint,t.FormIcon,t.FormInput,t.FormLabel,t.FormRadio;const h=t.FormRow,N=t.FormSection;t.FormSelect,t.FormSubLabel;const V=t.FormSwitch;t.FormTernaryCheckBox,t.FormText,t.FormTextColors,t.FormTextSizes;function I(e){window.enmity.plugins.registerPlugin(e)}const y={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,o)=>window.enmity.modules.filters.byName(e,o),byTypeName:(e,o)=>window.enmity.modules.filters.byTypeName(e,o),byDisplayName:(e,o)=>window.enmity.modules.filters.byDisplayName(e,o)};function H(...e){return window.enmity.modules.bulk(...e)}function O(...e){return window.enmity.modules.getByProps(...e)}window.enmity.modules.common;const u=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const n=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage,window.enmity.modules.common.Toasts;const T=window.enmity.modules.common.Dialog;window.enmity.modules.common.Token;const Y=window.enmity.modules.common.REST;window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const K=window.enmity.modules.common.Navigation;window.enmity.modules.common.NavigationNative,window.enmity.modules.common.NavigationStack,window.enmity.modules.common.Theme,window.enmity.modules.common.Linking;const z=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;function j(e){return window.enmity.patcher.create(e)}function k(e,o,s){return window.enmity.utilities.findInReactTree(e,o,s)}const{native:_}=window.enmity;function G(){_.reload()}_.version,_.build,_.device,_.version;function x(e,o,s){window.enmity.settings.set(e,o,s)}function $(e,o,s){return window.enmity.settings.get(e,o,s)}const U={name:"",version:"",rawUrl:"",changelog:[""],hash:"",remoteHash:null,remoteVersion:null,remoteChangelog:[""],create({name:e,version:o,rawUrl:s,changelog:i,hash:a}){if(!e||!o||!s||!i||!a)return console.error(`[${e||__filename}] Missing parameters in constructor`);this.name=e,this.version=o,this.rawUrl=s,this.changelog=i,this.hash=a,$(e,"_didUpdate",!1)||($(e,"_changelog",o)!==o&&this.showChangelog(),$(e,"autoUpdateCheck",!0)&&this.hash!=="DEBUG"&&this.checkForUpdates()),x(e,"_didUpdate",!1)},showChangelog(){!this.changelog||T.show({title:`${this.name} - v${this.version}`,body:`- ${this.changelog.join(`
- `)}`,confirmText:"OK",onConfirm:()=>x(this.name,"_changelog",this.version)})},async checkForUpdates(e=!1){var o,s,i,a,r,l;const d=await(await fetch(`${this.rawUrl}?${Math.random()}`)).text(),p=(o=d.match(/hash:(\w+)/))==null?void 0:o[1],b=(s=d.match(new RegExp(`${p}="([^,"]+)"`)))==null?void 0:s[1];b?this.remoteHash=b!=null?b:"0AB1C2":console.warn(`[${this.name}] Failed to fetch remote hash`);const S=(i=d.match(/version:(\w+)/))==null?void 0:i[1],E=(a=d.match(new RegExp(`${S}="([^,"]+)"`)))==null?void 0:a[1];E?this.remoteVersion=E:console.warn(`[${this.name}] Failed to fetch remote version`);const w=(r=d.match(/changelog:(\w+)/))==null?void 0:r[1],m=(l=d.match(new RegExp(`${w}=\\[(.*?)\\]`)))==null?void 0:l[0];if(m?this.remoteChangelog=JSON.parse(m.replace(`${w}=`,"")):console.warn(`[${this.name}] Failed to fetch remote changelog`),this.remoteHash&&this.remoteVersion){const f=this.version.split(".").map(Number),L=this.remoteVersion.split(".").map(Number);for(let v=0;v<f.length;v++){if(L[v]>f[v])return this.showUpdateDialog({version:this.remoteVersion,changelog:this.remoteChangelog});if(L[v]<f[v])return console.log(`[${this.name}] Remote version is older than local version`)}if(this.remoteHash!==this.hash)return this.showUpdateDialog({hash:this.remoteHash})}!e||T.show({title:"Plugin Updater",body:`No update available for ${this.name}`,confirmText:"OK"})},showUpdateDialog({version:e,hash:o,changelog:s}){if(!e&&!o)return console.error(`[${this.name}] Missing parameters in showUpdateDialog()`);let i="";e?i=`New Version for ${this.name} is available!`:i=`New Build for ${this.name} is available!`,i+=`
Would you like to update now?`,s&&(i+=`

Changelog:
- ${s.join(`
- `)}`),T.show({title:"Plugin Updater",body:i,confirmText:"Update",cancelText:"No",onConfirm:()=>{x(this.name,"_didUpdate",!0),this.installPlugin(!!o)}})},installPlugin(e=!1){var o;const s=e?"updated Build":"updated Version",i=e?`\`${(o=this.remoteHash)==null?void 0:o.slice(0,7)}\``:this.remoteVersion;window.enmity.plugins.installPlugin(`${this.rawUrl}?${Math.random()}`,({data:a})=>{a==="installed_plugin"||a==="overridden_plugin"?T.show({title:`Installed ${this.name} v${this.remoteVersion}`,body:`Successfully ${s} to **${i}**.
Would you like to reload Discord now?`,confirmText:"Reload",cancelText:"Later",onConfirm:G}):console.error(`[${this.name}] Failed to install v${i}`)})}},R=O("transitionToGuild","openURL");U.create(F.default);var W=({settings:e})=>{const o=z.createThemedStyleSheet({item:{color:u.ThemeColorMap.TEXT_MUTED},text_container:{paddingLeft:15,paddingTop:5,flexDirection:"column",flexWrap:"wrap"},main_text:{opacity:.975,letterSpacing:.25},header:{color:u.ThemeColorMap.HEADER_PRIMARY,fontFamily:u.Fonts.DISPLAY_BOLD,fontSize:25,letterSpacing:.25},sub_header:{color:u.ThemeColorMap.HEADER_SECONDARY,opacity:.975,fontSize:12.75}}),[s,i]=n.useState(),[a,r]=n.useState();return n.createElement(n.Fragment,null,n.createElement(M,{onTouchStart:l=>{i(l.nativeEvent.pageX),r(l.nativeEvent.pageY)},onTouchEnd:l=>{s-l.nativeEvent.pageX<-100&&a-l.nativeEvent.pageY<40&&a-l.nativeEvent.pageY>-40&&K.pop()}},n.createElement(C,null,n.createElement(C,{style:o.text_container},n.createElement(g,{style:[o.main_text,o.header]},c.name),n.createElement(C,{style:{flexDirection:"row"}},n.createElement(g,{style:[o.main_text,o.sub_header]},"Author:"),n.createElement(g,{style:[o.main_text,o.sub_header,{paddingLeft:4,fontFamily:u.Fonts.DISPLAY_BOLD}]},` ${c.authors.map(l=>l.name).join(", ")}`)),n.createElement(C,{style:{flexDirection:"row"}},n.createElement(g,{style:[o.main_text,o.sub_header]},"Version:"),n.createElement(g,{style:[o.main_text,o.sub_header,{paddingLeft:4,fontFamily:u.Fonts.DISPLAY_BOLD}]},` ${c.version}`)),n.createElement(C,{style:{flexDirection:"row"}},n.createElement(g,{style:[o.main_text,o.sub_header]},"Hash:"),n.createElement(g,{style:[o.main_text,o.sub_header,{paddingLeft:4,fontFamily:u.Fonts.DISPLAY_BOLD}]},` ${c.hash.slice(0,7)}`)))),n.createElement(N,{title:"Updates"},n.createElement(h,{label:"Check for Updates on startup",subLabel:"Checks automatically for updates when starting the Plugin",trailing:n.createElement(V,{value:e.getBoolean("autoUpdateCheck",!0),onValueChange:()=>e.toggle("autoUpdateCheck",!0)})}),n.createElement(h,{label:"Check for Updates",trailing:h.Arrow,onPress:()=>U.checkForUpdates(!0)}),n.createElement(h,{label:"Show Changelog",subLabel:`Shows the changelog for v${c.version}`,trailing:h.Arrow,onPress:()=>U.showChangelog(),disabled:!c.changelog.length})),n.createElement(N,{title:"Source"},n.createElement(h,{label:"Source",subLabel:`See the Source Code for ${c.name}`,trailing:h.Arrow,onPress:()=>R==null?void 0:R.openURL(c.sourceUrl)}))))};const D=1<<2,[X,q,J,Q,Z,ee,te]=H(y.byName("ActionSheet",!1),y.byProps("getChannel"),y.byProps("Messages"),y.byName("Icon"),y.byProps("openLazy","hideActionSheet"),y.byProps("getChannelPermissions"),y.byProps("getCurrentUser","getUser")),P=j(F.default.name),oe={...F.default,onStart(){P.after(X,"default",(e,o,s)=>{const i=k(s,a=>a.sheetKey);(i==null?void 0:i.sheetKey)&&i.sheetKey!=="MessageLongPressActionSheet"||P.after(i==null?void 0:i.content,"type",(a,[{message:r}],l)=>{const d=q.getChannel(r.channel_id),p=!!(r.flags&D),b=!!(ee.getChannelPermissions({id:r.channel_id})&u.Permissions.EMBED_LINKS);if(!p&&!r.embeds.length||r.author.id===te.getCurrentUser().id&&!b)return;const S=k(l,w=>Array.isArray(w)&&w.find(m=>{var f;return typeof(m==null?void 0:m.key)=="string"&&typeof((f=m==null?void 0:m.props)==null?void 0:f.message)=="string"})),E=S==null?void 0:S.findIndex(w=>{var m;return((m=w.props)==null?void 0:m.message)===J.Messages.DELETE_MESSAGE});E!==-1&&S.splice(E,0,n.createElement(h,{key:F.default.name,label:p?"Unsuppress Embeds":"Suppress Embeds",leading:n.createElement(Q,{source:A(p?"ic_message_retry":"ic_close_16px")}),onPress:()=>{Y.patch({url:`/channels/${d.id}/messages/${r.id}`,body:{flags:p?r.flags&~D:r.flags|D}}),Z.hideActionSheet()}}))})})},onStop(){P.unpatchAll()},getSettingsPanel({settings:e}){return n.createElement(W,{settings:e})}};I(oe);
